# Internationalization (i18n)

## Overview

Linguami uses **next-translate** for internationalization, supporting 3 interface languages: French (fr), Russian (ru), and English (en).

**Configuration:** `/i18n.json`

## Configuration

```json
{
  "locales": ["fr", "ru", "en"],
  "defaultLocale": "fr",
  "pages": {
    "*": ["common"],
    "/": ["home"],
    "/blog": ["blog"],
    "/materials": ["materials"],
    "/materials/[section]": ["materials", "section"],
    "/materials/[section]/[material]": ["register", "materials", "words", "admin", "exercises"],
    "/my-materials": ["materials"],
    "/dictionary": ["common", "words"],
    "/login": ["register"],
    "/signup": ["register"],
    "/method/[level]": ["common"],
    "/method/[level]/[courseSlug]": ["common"]
  }
}
```

## Translation Files Structure

```
locales/
├── fr/
│   ├── common.json       # Global UI strings
│   ├── home.json         # Homepage
│   ├── materials.json    # Materials page
│   ├── words.json        # Dictionary
│   ├── register.json     # Auth pages
│   ├── exercises.json    # Exercises
│   └── admin.json        # Admin panel
├── ru/
│   └── ... (same structure)
└── en/
    └── ... (same structure)
```

## Usage

### Basic Usage

```javascript
import useTranslation from 'next-translate/useTranslation'

function Component() {
  const { t, lang } = useTranslation('namespace')

  return (
    <div>
      <h1>{t('title')}</h1>
      <p>{t('description')}</p>
      <p>Current language: {lang}</p>
    </div>
  )
}
```

### With Variables

```javascript
const { t } = useTranslation('common')

// Translation: "Hello {{name}}, you have {{count}} messages"
const greeting = t('greeting', { name: 'John', count: 5 })
// Result: "Hello John, you have 5 messages"
```

### Pluralization

```javascript
const { t } = useTranslation('common')

// Translation keys:
// "days": "day",
// "days_plural": "days"

const text = t('days', { count: 1 })  // "1 day"
const text = t('days', { count: 5 })  // "5 days"
```

## Common Namespaces

### common.json

Global UI strings used across the app:

**Navigation:**
- `learn`, `speak`, `french`, `russian`, `english`
- `material`, `methode`, `blog`, `teacher`, `lessons`
- `signin`, `signup`, `logout`, `settings`

**Actions:**
- `start`, `signin`, `signup`, `register`
- `methode_start`, `methode_lets_go`, `methode_buy`

**Method System:**
All method-related keys prefixed with `methode_`:
- `methode_title`, `methode_subtitle`, `methode_description`
- `methode_free`, `methode_locked`, `methode_unlocked`
- `methode_lesson`, `methode_lessons`, `methode_progress`
- `methode_objectives`, `methode_completed`
- `methode_block_dialogue`, `methode_block_grammar`, etc.
- `methode_play_all`, `methode_pause`, `methode_speed_normal`
- `methode_exercise_check`, `methode_exercise_retry`

**Toasts:**
- `loginSuccess`, `passwordUpdateSuccess`
- `materialAddedToStudying`, `materialRemovedFromStudying`
- `congratsProgress`, `congratsProgressRussian`, `congratsProgressFrench`

**Achievements:**
- `achievement_level_up_title`, `achievement_level_up_desc`
- `achievement_daily_goal_title`, `achievement_streak_title`

**Example:**
```json
{
  "learn": "J'apprends",
  "french": "Français",
  "start": "Commencer",
  "methode_title": "La Méthode Linguami",
  "methode_start": "Commencer",
  "methode_progress": "Progression",
  "loginSuccess": "Vous êtes bien connecté"
}
```

### materials.json

Materials page strings:
- Material categories
- Filtering labels
- Empty states

### words.json

Dictionary page strings:
- Word management
- SRS card states
- Study modes

### exercises.json

Exercise components:
- Exercise types
- Instructions
- Feedback messages

### register.json

Authentication pages:
- Login/signup forms
- Password reset
- Email verification

## Language Switching

### URL-based Routing

Next.js automatically handles language routing:

```
/fr/materials       # French interface
/ru/materials       # Russian interface
/en/materials       # English interface
```

### Programmatic Navigation

```javascript
import { useRouter } from 'next/router'

function LanguageSwitcher() {
  const router = useRouter()
  const { pathname, query, asPath } = router

  const changeLanguage = (locale) => {
    router.push({ pathname, query }, asPath, { locale })
  }

  return (
    <div>
      <button onClick={() => changeLanguage('fr')}>Français</button>
      <button onClick={() => changeLanguage('ru')}>Русский</button>
      <button onClick={() => changeLanguage('en')}>English</button>
    </div>
  )
}
```

### Link Component with Locale

```javascript
import Link from 'next/link'
import { useRouter } from 'next/router'

function NavLink() {
  const router = useRouter()

  return (
    <Link href="/materials" locale={router.locale}>
      Materials
    </Link>
  )
}
```

## Three-Language System

⚠️ **IMPORTANT:** Linguami uses THREE distinct language concepts:

### 1. Interface Language (locale)

**What it is:** Language of the UI/menus/buttons

**Values:** `fr`, `ru`, `en`

**How it's set:** URL prefix (`/fr/`, `/ru/`, `/en/`)

**Access:**
```javascript
import { useRouter } from 'next/router'

const router = useRouter()
const interfaceLang = router.locale  // 'fr', 'ru', or 'en'
```

### 2. Learning Language

**What it is:** Language the user is STUDYING (target language)

**Values:** `fr`, `ru` (en suspended)

**How it's stored:**
- Auth users: `users_profile.learning_language`
- Guest users: `localStorage.getItem('learning_language')`

**Access:**
```javascript
import { useUserContext } from '@/context/user'

const { userLearningLanguage } = useUserContext()
// Works for both auth & guest users
```

**Usage:** Used to filter materials and courses:
```javascript
// Fetch materials in learning language
const { data } = await supabase
  .from('materials')
  .select('*')
  .eq('lang', userLearningLanguage)
```

### 3. Spoken Language

**What it is:** User's NATIVE language (for lesson explanations)

**Values:** `fr`, `ru`, `en`

**How it's stored:**
- Auth users: `users_profile.spoken_language`
- Guest users: defaults to interface language

**Access:**
```javascript
import { useUserContext } from '@/context/user'
import { useRouter } from 'next/router'

const { userProfile } = useUserContext()
const router = useRouter()

const spokenLang = userProfile?.spoken_language || router.locale
```

**Usage:** Used to select lesson content blocks:
```javascript
// Get lesson blocks in spoken language
const blocksKey = `blocks_${spokenLanguage}`  // e.g., 'blocks_fr'
const blocks = lesson[blocksKey]
```

### Example Scenarios

**French speaker learning Russian with English interface:**
```javascript
{
  locale: 'en',              // Interface: English UI
  learningLanguage: 'ru',    // Learning: Russian materials
  spokenLanguage: 'fr'       // Spoken: French explanations
}
```

**Russian speaker learning French with Russian interface:**
```javascript
{
  locale: 'ru',              // Interface: Russian UI
  learningLanguage: 'fr',    // Learning: French materials
  spokenLanguage: 'ru'       // Spoken: Russian explanations
}
```

## Adding New Translations

### 1. Add keys to all locale files

```json
// locales/fr/common.json
{
  "new_feature_title": "Nouvelle fonctionnalité",
  "new_feature_desc": "Description en français"
}

// locales/en/common.json
{
  "new_feature_title": "New Feature",
  "new_feature_desc": "Description in English"
}

// locales/ru/common.json
{
  "new_feature_title": "Новая функция",
  "new_feature_desc": "Описание на русском"
}
```

### 2. Use in component

```javascript
import useTranslation from 'next-translate/useTranslation'

function NewFeature() {
  const { t } = useTranslation('common')

  return (
    <div>
      <h2>{t('new_feature_title')}</h2>
      <p>{t('new_feature_desc')}</p>
    </div>
  )
}
```

## Adding New Pages with i18n

### 1. Create translation files

```json
// locales/fr/my-page.json
{
  "title": "Ma page",
  "subtitle": "Sous-titre"
}

// locales/en/my-page.json
{
  "title": "My Page",
  "subtitle": "Subtitle"
}

// locales/ru/my-page.json
{
  "title": "Моя страница",
  "subtitle": "Подзаголовок"
}
```

### 2. Update i18n.json

```json
{
  "pages": {
    "*": ["common"],
    "/my-page": ["my-page"]
  }
}
```

### 3. Create page component

```javascript
// pages/my-page.js
import useTranslation from 'next-translate/useTranslation'

export default function MyPage() {
  const { t } = useTranslation('my-page')

  return (
    <div>
      <h1>{t('title')}</h1>
      <p>{t('subtitle')}</p>
    </div>
  )
}
```

## Multilingual Database Content

For database content that needs translations (courses, lessons, materials):

### Pattern: Field per Language

```javascript
// Database columns
title_fr: "Cours de russe"
title_en: "Russian Course"
title_ru: "Курс русского языка"

// In component
const { lang } = useTranslation('common')
const title = course[`title_${lang}`]  // Auto-select based on interface language
```

### Pattern: JSONB Blocks

```javascript
// Database columns (JSONB)
blocks_fr: [{type: "dialogue", ...}]  // French explanations
blocks_en: [{type: "dialogue", ...}]  // English explanations
blocks_ru: [{type: "dialogue", ...}]  // Russian explanations

// In component
const spokenLanguage = userProfile?.spoken_language || lang
const blocks = lesson[`blocks_${spokenLanguage}`]
```

## Toast Notifications with i18n

### Using toast helper

```javascript
import { useToastMessages } from '@/utils/toastMessages'

function Component() {
  const toastMessages = useToastMessages()

  const handleSuccess = () => {
    toast.success(toastMessages.loginSuccess())
  }

  const handleError = () => {
    toast.error(toastMessages.genericError())
  }

  return <button onClick={handleSuccess}>Show Toast</button>
}
```

### Direct usage

```javascript
import useTranslation from 'next-translate/useTranslation'
import toast from '@/utils/toast'

function Component() {
  const { t } = useTranslation('common')

  const handleClick = () => {
    toast.success(t('loginSuccess'))
  }

  return <button onClick={handleClick}>Login</button>
}
```

## SEO & Meta Tags

### Using next-translate with Head

```javascript
import Head from 'next/head'
import useTranslation from 'next-translate/useTranslation'

function Page() {
  const { t, lang } = useTranslation('my-page')

  return (
    <>
      <Head>
        <title>{t('meta_title')}</title>
        <meta name="description" content={t('meta_description')} />
        <meta property="og:title" content={t('meta_title')} />
        <meta property="og:locale" content={lang} />
      </Head>
      <div>{t('content')}</div>
    </>
  )
}
```

## Best Practices

### 1. Always use translation keys

❌ **Don't:**
```javascript
<button>Commencer</button>  // Hardcoded French
```

✅ **Do:**
```javascript
const { t } = useTranslation('common')
<button>{t('start')}</button>  // Translated
```

### 2. Consistent naming conventions

**Prefix by feature:**
- `methode_*` - Method system
- `exercise_*` - Exercises
- `admin_*` - Admin panel

**Suffix by type:**
- `*_title` - Titles
- `*_desc` - Descriptions
- `*_error` - Error messages
- `*_success` - Success messages

### 3. Keep translations in sync

When adding a key to one locale, immediately add it to all locales:
```bash
# Check for missing keys
npx i18n-check locales
```

### 4. Use variables for dynamic content

❌ **Don't:**
```javascript
t('hello') + ' ' + userName  // "Bonjour John"
```

✅ **Do:**
```json
// Translation
"hello": "Bonjour {{name}}"
```
```javascript
t('hello', { name: userName })
```

## Related Documentation

- [Authentication Flow](authentication.md) - Language preferences for users
- [Database Architecture](database.md) - Multilingual database fields
- [Method Courses](../features/method-courses.md) - Multilingual lesson content
